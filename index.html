<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Seoul Trip 2025</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Phosphor Icons (可愛風格圖標) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Google Fonts: 圓體字更有韓系手寫感 -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cream-bg': '#FDFBF7',     // 背景奶油白
                        'cream-card': '#FFFDF9',   // 卡片亮白
                        'soft-brown': '#8D7B68',   // 韓系深棕文字
                        'accent-beige': '#F3E9D2', // 裝飾米色
                        'highlight': '#C8B6A6',    // 輔助色
                        'alert-red': '#E07A5F'     // 重點提示色
                    },
                    fontFamily: {
                        sans: ['"Zen Maru Gothic"', 'Nunito', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* 隱藏捲軸但保持滾動功能，增加App質感 */
        body {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
            background-color: #FDFBF7;
        }
        body::-webkit-scrollbar {
            display: none;
        }
        
        .header-container {
            height: 250px;
            width: 100%;
            position: relative;
            background-color: #ddd; 
            overflow: hidden;
            cursor: pointer; /* 提示可點擊 */
        }
        
        .header-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            transition: transform 0.3s ease;
        }

        .header-container:hover .header-image {
            transform: scale(1.02);
        }

        /* 點擊更換提示遮罩 */
        .header-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .header-container:hover .header-overlay {
            opacity: 1;
        }

        .main-content {
            margin-top: -30px; 
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
            background-color: #FDFBF7;
            position: relative;
            z-index: 10;
            min-height: calc(100vh - 220px);
            padding-bottom: 80px; /* 增加底部留白給 Tab */
        }

        .nav-tabs {
            position: absolute;
            bottom: 40px; 
            right: 20px;
            display: flex;
            gap: 12px;
            z-index: 20;
        }

        .tab-btn {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(4px);
            border-radius: 16px;
            padding: 8px 16px;
            color: #8D7B68;
            font-size: 14px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
            border: 1px solid rgba(255,255,255,0.5);
        }

        .tab-btn.active {
            background: #8D7B68;
            color: #fff;
            transform: translateY(-2px);
        }

        /* 隱藏橫向捲軸 */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Modal 動畫 */
        .modal-enter-active,
        .modal-leave-active {
            transition: opacity 0.3s ease;
        }
        .modal-enter-from,
        .modal-leave-to {
            opacity: 0;
        }
    </style>
</head>
<body class="text-soft-brown antialiased selection:bg-accent-beige">

    <div id="app">
        <!-- 頁首區域 -->
        <header class="header-container" @click="triggerBannerUpload">
            <img :src="headerImage" 
                 class="header-image" 
                 alt="Header Banner"
                 @error="handleImageError">
            
            <!-- 懸停提示 -->
            <div class="header-overlay">
                <div class="bg-black/30 text-white px-4 py-2 rounded-full backdrop-blur-md text-sm font-bold flex items-center gap-2">
                    <i class="ph-bold ph-camera"></i> 點擊更換封面
                </div>
            </div>
            
            <!-- 標題區域 (還原為原始樣式) -->
            <div class="absolute top-8 left-6 text-white drop-shadow-md">
                <h1 class="text-3xl font-bold tracking-wider">Seoul Trip</h1>
                <p class="text-sm opacity-90 tracking-widest">2025.12.27 - 2026.01.02</p>
            </div>

            <!-- 隱藏的檔案上傳 Input -->
            <input type="file" ref="bannerInput" @change="handleBannerChange" accept="image/*" class="hidden">

            <!-- 浮動導覽列 (Tabs) -->
            <div class="nav-tabs">
                <button 
                    v-for="tab in tabs" 
                    :key="tab.id"
                    @click.stop="currentTab = tab.id"
                    class="tab-btn"
                    :class="{ 'active': currentTab === tab.id }"
                >
                    <i :class="tab.icon" class="text-lg"></i>
                    <span v-if="currentTab === tab.id">{{ tab.name }}</span>
                </button>
            </div>
        </header>

        <!-- 主內容區域 -->
        <main class="main-content px-5 pt-8">
            
            <!-- 1. 行程表 (Itinerary) - 更新為單日顯示模式 -->
            <div v-if="currentTab === 'schedule'" class="space-y-4">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-bold">每日行程</h2>
                    <span class="text-xs text-gray-400">點擊天氣可切換</span>
                </div>

                <!-- 天數選擇器 (橫向捲動) -->
                <div class="flex overflow-x-auto gap-3 pb-2 mb-2 no-scrollbar -mx-5 px-5">
                    <button 
                        v-for="(day, index) in itinerary" 
                        :key="index"
                        @click="currentDayIndex = index"
                        class="flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold transition-all shadow-sm border"
                        :class="currentDayIndex === index ? 'bg-soft-brown text-white border-soft-brown' : 'bg-white text-gray-400 border-gray-100'"
                    >
                        Day {{ index + 1 }}
                    </button>
                </div>

                <!-- 當前選中的天行程卡片 -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-stone-100 min-h-[400px] relative transition-all">
                    <!-- 卡片標頭：日期與天氣 -->
                    <div class="flex items-center justify-between mb-5 border-b border-dashed border-stone-200 pb-3">
                        <div>
                            <h3 class="text-xl font-bold text-soft-brown">Day {{ currentDayIndex + 1 }}</h3>
                            <span class="text-sm text-gray-400 font-medium">{{ currentDayData.date }}</span>
                        </div>
                        <!-- 天氣切換按鈕 -->
                        <div class="flex flex-col items-end">
                            <button @click="cycleWeather(currentDayIndex)" class="flex flex-col items-center bg-blue-50 px-3 py-1 rounded-lg hover:bg-blue-100 transition min-w-[60px]">
                                <i :class="getWeatherIcon(currentDayData.weather)" class="text-2xl text-blue-500 mb-1"></i>
                                <span class="text-[10px] text-blue-400 font-bold">{{ getWeatherName(currentDayData.weather) }}</span>
                            </button>
                            <span v-if="currentDayData.temp" class="text-xs font-bold text-gray-400 mt-1 tracking-wider">{{ currentDayData.temp }}</span>
                        </div>
                    </div>
                    
                    <!-- 行程列表 -->
                    <div v-if="currentDayData.events.length > 0" class="space-y-6 relative pl-2">
                        <!-- 左側時間線 -->
                        <div class="absolute left-[9px] top-2 bottom-4 w-[2px] bg-accent-beige rounded-full"></div>

                        <div v-for="(item, i) in currentDayData.events" :key="i" class="flex gap-4 relative group">
                            <!-- 時間點 -->
                            <div class="z-10 mt-1 relative">
                                <div class="w-4 h-4 rounded-full bg-cream-bg border-4 border-soft-brown"></div>
                            </div>
                            
                            <!-- 內容區塊 -->
                            <div class="flex-1 bg-gray-50 rounded-xl p-3 border border-transparent hover:border-accent-beige transition-colors relative">
                                <div class="flex justify-between items-start mb-1">
                                    <h4 class="font-bold text-soft-brown text-lg">{{ item.title }}</h4>
                                    
                                    <!-- 編輯按鈕 -->
                                    <button @click="openEditModal(i)" class="text-gray-300 hover:text-soft-brown p-1">
                                        <i class="ph-bold ph-pencil-simple"></i>
                                    </button>
                                </div>
                                
                                <span v-if="item.time" class="inline-block text-xs font-bold text-white bg-highlight px-2 py-0.5 rounded mb-2">
                                    {{ item.time }}
                                </span>

                                <!-- 圖片顯示區域 (新增) -->
                                <div v-if="item.image" class="mb-3 rounded-lg overflow-hidden w-full max-h-48 border border-gray-100 shadow-sm">
                                    <img :src="item.image" class="w-full h-full object-cover" alt="Event Image">
                                </div>

                                <p v-if="item.desc" class="text-sm text-gray-500 whitespace-pre-line leading-relaxed mb-2">{{ item.desc }}</p>
                                
                                <div v-if="item.note" class="bg-red-50 p-2 rounded-lg border border-red-100 mb-2">
                                    <p class="text-xs text-alert-red font-bold flex items-center gap-1">
                                        <i class="ph-fill ph-star"></i> {{ item.note }}
                                    </p>
                                </div>

                                <!-- 按鈕區域：地點與連結 -->
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <a v-if="item.location" :href="getNaverLink(item.location)" target="_blank" class="inline-flex items-center gap-1 text-xs text-green-600 font-bold hover:underline bg-green-50 px-2 py-1.5 rounded-lg border border-green-100 transition-colors hover:bg-green-100">
                                        <i class="ph-fill ph-map-pin"></i> {{ item.location }}
                                    </a>
                                    
                                    <!-- 新增：連結按鈕 -->
                                    <a v-if="item.link" :href="item.link" target="_blank" class="inline-flex items-center gap-1 text-xs text-blue-600 font-bold hover:underline bg-blue-50 px-2 py-1.5 rounded-lg border border-blue-100 transition-colors hover:bg-blue-100">
                                        <i class="ph-bold ph-link"></i> 開啟連結
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 空行程提示 -->
                    <div v-else class="text-center py-10 text-gray-300">
                        <i class="ph ph-coffee text-4xl mb-2 block"></i>
                        <p>今天還沒有安排行程喔</p>
                    </div>

                    <!-- 新增行程按鈕 -->
                    <button @click="openAddModal" class="w-full mt-6 py-3 border-2 border-dashed border-accent-beige rounded-xl text-soft-brown font-bold hover:bg-accent-beige hover:border-solid transition-colors flex items-center justify-center gap-2">
                        <i class="ph-bold ph-plus"></i> 新增行程
                    </button>
                </div>
            </div>

            <!-- 2. 資訊 (Info) -->
            <div v-if="currentTab === 'info'" class="space-y-5">
                <h2 class="text-2xl font-bold mb-4">旅程資訊</h2>
                <!-- 必備檢查 -->
                <div class="bg-amber-50 rounded-2xl p-5 border border-amber-100">
                    <h3 class="font-bold text-amber-800 flex items-center gap-2 mb-3">
                        <i class="ph-fill ph-warning-circle"></i> 重要提醒
                    </h3>
                    <ul class="text-sm text-amber-900 space-y-2 list-disc list-inside mb-4">
                        <li><strong>電子入境表單 (K-ETA/Q-Code)：</strong><br>需在出發前 72 小時填寫。</li>
                        <li><strong>準備護照</strong>：確保有效期。</li>
                    </ul>
                    <a href="https://e-arrivalcard.go.kr/portal/main/index.do" target="_blank" class="w-full bg-amber-200 text-amber-900 font-bold py-3 rounded-xl flex items-center justify-center gap-2 hover:bg-amber-300 transition shadow-sm">
                        <i class="ph-bold ph-pencil-simple-line"></i> 
                        填寫電子入境卡 (Q-Code)
                    </a>
                </div>

                <!-- 航班 -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-stone-100">
                    <h3 class="font-bold text-soft-brown flex items-center gap-2 mb-3">
                        <i class="ph-fill ph-airplane-tilt text-blue-400"></i> 航班資訊
                    </h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center bg-gray-50 p-3 rounded-xl">
                            <div class="text-center">
                                <div class="text-xl font-bold">TSA</div>
                                <div class="text-xs text-gray-400">松山</div>
                                <div class="text-sm font-bold mt-1">09:20</div>
                            </div>
                            <div class="flex-1 flex flex-col items-center px-2">
                                <span class="text-xs font-bold text-soft-brown">BR156 (12/27)</span>
                                <div class="h-[1px] w-full bg-gray-300 my-1 relative">
                                    <i class="ph-fill ph-airplane absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-gray-300 bg-gray-50 p-1"></i>
                                </div>
                                <span class="text-xs text-gray-400">去程</span>
                            </div>
                            <div class="text-center">
                                <div class="text-xl font-bold">GMP</div>
                                <div class="text-xs text-gray-400">金浦</div>
                                <div class="text-sm font-bold mt-1">12:50</div>
                            </div>
                        </div>

                        <div class="flex justify-between items-center bg-gray-50 p-3 rounded-xl">
                            <div class="text-center">
                                <div class="text-xl font-bold">GMP</div>
                                <div class="text-xs text-gray-400">金浦</div>
                                <div class="text-sm font-bold mt-1">13:50</div>
                            </div>
                            <div class="flex-1 flex flex-col items-center px-2">
                                <span class="text-xs font-bold text-soft-brown">BR155 (01/02)</span>
                                <div class="h-[1px] w-full bg-gray-300 my-1 relative">
                                    <i class="ph-fill ph-airplane absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-gray-300 bg-gray-50 p-1 rotate-180"></i>
                                </div>
                                <span class="text-xs text-gray-400">回程</span>
                            </div>
                            <div class="text-center">
                                <div class="text-xl font-bold">TSA</div>
                                <div class="text-xs text-gray-400">松山</div>
                                <div class="text-sm font-bold mt-1">15:35</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 住宿 -->
                <div class="bg-white rounded-2xl p-5 shadow-sm border border-stone-100">
                    <h3 class="font-bold text-soft-brown flex items-center gap-2 mb-3">
                        <i class="ph-fill ph-house-line text-green-500"></i> 住宿資料
                    </h3>
                    
                    <div class="space-y-6">
                        <div class="pb-4 border-b border-dashed border-gray-200">
                            <div class="flex justify-between items-start">
                                <div>
                                    <span class="font-bold text-lg block">Wecostay Namsam</span>
                                    <p class="text-xs text-gray-400 mt-0.5">Check-in: 16:00 / Out: 11:00</p>
                                </div>
                                <span class="text-xs bg-gray-100 px-2 py-1 rounded h-fit font-bold text-gray-600">12/27 - 12/31</span>
                            </div>
                            
                            <!-- 地址區塊 -->
                            <div class="bg-gray-50 p-3 mt-3 rounded-lg cursor-pointer active:bg-gray-100 relative group" @click="copyText('04554 중구 필동1가 43-1')">
                                <p class="text-sm text-gray-600">04554 중구 필동1가 43-1</p>
                                <p class="text-xs text-gray-400 mt-1 flex items-center gap-1"><i class="ph-bold ph-copy"></i> 點擊複製韓文地址</p>
                            </div>

                            <!-- 電話區塊 (新增) -->
                            <div class="bg-gray-50 p-3 mt-2 rounded-lg cursor-pointer active:bg-gray-100 relative group" @click="copyText('+82 70-4138-3576')">
                                <div class="flex items-center gap-2">
                                    <i class="ph-fill ph-phone text-soft-brown"></i>
                                    <span class="text-sm text-gray-600 font-bold">+82 70-4138-3576</span>
                                </div>
                                <p class="text-xs text-gray-400 mt-1 pl-6 flex items-center gap-1"><i class="ph-bold ph-copy"></i> 點擊複製電話</p>
                            </div>

                            <a :href="getNaverLink('04554 중구 필동1가 43-1')" target="_blank" class="w-full mt-3 bg-green-50 text-green-600 py-2 rounded-lg text-sm font-bold flex items-center justify-center gap-2 hover:bg-green-100 transition">
                                <i class="ph-fill ph-map-trifold"></i> 開啟 Naver Map
                            </a>
                        </div>

                        <div>
                            <div class="flex justify-between items-start">
                                <div>
                                    <span class="font-bold text-lg block">Airbnb</span>
                                    <p class="text-xs text-gray-400 mt-0.5">Check-in: 15:00 / Out: 11:00</p>
                                </div>
                                <span class="text-xs bg-gray-100 px-2 py-1 rounded h-fit font-bold text-gray-600">01/01 - 01/02</span>
                            </div>

                            <div class="bg-gray-50 p-3 mt-3 rounded-lg cursor-pointer active:bg-gray-100 relative group" @click="copyText('首尔特别市 广津区 紫阳洞 5-53')">
                                <p class="text-sm text-gray-600">首尔特别市 广津区 紫阳洞 5-53</p>
                                <p class="text-xs text-gray-400 mt-1 flex items-center gap-1"><i class="ph-bold ph-copy"></i> 點擊複製中文地址</p>
                            </div>

                            <a :href="getNaverLink('首尔特别市 广津区 紫阳洞 5-53')" target="_blank" class="w-full mt-3 bg-green-50 text-green-600 py-2 rounded-lg text-sm font-bold flex items-center justify-center gap-2 hover:bg-green-100 transition">
                                <i class="ph-fill ph-map-trifold"></i> 開啟 Naver Map
                            </a>
                        </div>
                    </div>
                </div>
                 <a href="https://www.accuweather.com/zh/kr/seoul/226081/december-weather/226081" target="_blank" class="block bg-blue-50 rounded-2xl p-4 text-center text-blue-600 font-bold hover:bg-blue-100 transition">
                    <i class="ph-fill ph-cloud-sun"></i> 查看首爾天氣預報
                 </a>
            </div>

            <!-- 3. 購物清單 (Shopping) -->
            <div v-if="currentTab === 'shopping'" class="space-y-4">
                <h2 class="text-2xl font-bold mb-2">購物清單</h2>
                
                <!-- 人物切換 Tab -->
                <div class="bg-gray-100 p-1 rounded-xl flex gap-1 mb-2">
                    <button 
                        @click="currentShopper = 'Wawa'"
                        class="flex-1 py-2 rounded-lg text-sm font-bold transition-all duration-200"
                        :class="currentShopper === 'Wawa' ? 'bg-white text-soft-brown shadow-sm' : 'text-gray-400 hover:text-gray-600'"
                    >
                        <i class="ph-bold ph-smiley"></i> Wawa
                    </button>
                    <button 
                        @click="currentShopper = 'Cherisa'"
                        class="flex-1 py-2 rounded-lg text-sm font-bold transition-all duration-200"
                        :class="currentShopper === 'Cherisa' ? 'bg-white text-soft-brown shadow-sm' : 'text-gray-400 hover:text-gray-600'"
                    >
                        <i class="ph-bold ph-smiley-wink"></i> Cherisa
                    </button>
                </div>

                <div class="flex gap-2">
                    <input v-model="newItem" @keyup.enter="addItem" type="text" :placeholder="`想幫 ${currentShopper} 買什麼？`" class="flex-1 bg-white border border-stone-200 rounded-xl px-4 py-3 focus:outline-none focus:border-soft-brown shadow-sm text-sm">
                    <button @click="addItem" class="bg-soft-brown text-white rounded-xl px-4 font-bold shadow-md hover:bg-stone-600">
                        <i class="ph-bold ph-plus"></i>
                    </button>
                </div>

                <div class="space-y-2 mt-4">
                    <div v-if="filteredShoppingList.length === 0" class="text-center text-gray-300 py-10">
                        <i class="ph ph-bag text-4xl mb-2 block"></i>
                        {{ currentShopper }} 的清單是空的喔
                    </div>
                    
                    <div v-for="(item) in filteredShoppingList" :key="item.id" 
                         class="bg-white p-4 rounded-xl shadow-sm border border-stone-100 flex items-center justify-between group transition-all"
                         :class="{'opacity-50': item.done}">
                        <div class="flex items-center gap-3">
                            <button @click="item.done = !item.done" 
                                    class="w-6 h-6 rounded-full border-2 flex items-center justify-center transition-colors"
                                    :class="item.done ? 'bg-green-500 border-green-500' : 'border-stone-300'">
                                <i v-if="item.done" class="ph-bold ph-check text-white text-xs"></i>
                            </button>
                            <span :class="{'line-through text-gray-400': item.done}">{{ item.text }}</span>
                        </div>
                        <button @click="deleteItem(item)" class="text-gray-300 hover:text-red-400">
                            <i class="ph-fill ph-trash"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 4. 花費 (Money) -->
            <div v-if="currentTab === 'money'" class="space-y-5">
                <h2 class="text-2xl font-bold mb-4">旅費記帳</h2>
                
                <!-- 總覽卡片 (更新：雙幣別分開顯示) -->
                <div class="bg-soft-brown text-white rounded-2xl p-5 shadow-lg relative overflow-hidden">
                    <div class="absolute -right-5 -top-5 w-24 h-24 bg-white opacity-10 rounded-full"></div>
                    
                    <!-- 總支出列 -->
                    <div class="flex justify-between items-end border-b border-white/20 pb-4 mb-4">
                        <div>
                            <p class="text-xs opacity-80">總支出 (KRW)</p>
                            <h3 class="text-2xl font-bold mt-1">₩ {{ totalKRW.toLocaleString() }}</h3>
                        </div>
                        <div class="text-right">
                            <p class="text-xs opacity-80">總支出 (TWD)</p>
                            <h3 class="text-2xl font-bold mt-1">NT$ {{ totalTWD.toLocaleString() }}</h3>
                        </div>
                    </div>

                    <!-- 代墊明細 -->
                    <div class="grid grid-cols-2 gap-4 text-xs mb-4">
                        <div class="space-y-1">
                            <span class="font-bold opacity-90 block border-b border-white/10 pb-1 mb-1">Wawa 代墊</span>
                            <div class="flex justify-between"><span class="opacity-70">KRW</span> <span>{{ wawaPaidKRW.toLocaleString() }}</span></div>
                            <div class="flex justify-between"><span class="opacity-70">TWD</span> <span>{{ wawaPaidTWD.toLocaleString() }}</span></div>
                        </div>
                        <div class="space-y-1 text-right">
                            <span class="font-bold opacity-90 block border-b border-white/10 pb-1 mb-1">Cherisa 代墊</span>
                            <div class="flex justify-between justify-end gap-2"><span class="opacity-70">KRW</span> <span>{{ cherisaPaidKRW.toLocaleString() }}</span></div>
                            <div class="flex justify-between justify-end gap-2"><span class="opacity-70">TWD</span> <span>{{ cherisaPaidTWD.toLocaleString() }}</span></div>
                        </div>
                    </div>

                    <!-- 分帳結果 -->
                    <div class="bg-white/10 rounded-xl p-3 text-center backdrop-blur-sm">
                        <p class="text-[10px] opacity-70 mb-2">分帳建議 (各付各的一半)</p>
                        <div class="space-y-1">
                            <p class="font-bold text-sm text-accent-beige" v-if="settlementKRWText">
                                {{ settlementKRWText }}
                            </p>
                            <p class="font-bold text-sm text-accent-beige" v-if="settlementTWDText">
                                {{ settlementTWDText }}
                            </p>
                            <p v-if="!settlementKRWText && !settlementTWDText" class="text-sm opacity-80">
                                目前兩不相欠！
                            </p>
                        </div>
                    </div>
                </div>

                <!-- 新增支出區塊 -->
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-stone-100">
                    <!-- 付款人選擇 -->
                    <div class="flex gap-2 mb-3">
                        <button 
                            @click="newExpense.payer = 'Wawa'"
                            class="flex-1 py-2 rounded-lg text-xs font-bold border transition-all flex items-center justify-center gap-1"
                            :class="newExpense.payer === 'Wawa' ? 'bg-soft-brown text-white border-soft-brown' : 'bg-white text-gray-400 border-gray-200'"
                        >
                            <i class="ph-fill ph-user"></i> Wawa 付款
                        </button>
                        <button 
                            @click="newExpense.payer = 'Cherisa'"
                            class="flex-1 py-2 rounded-lg text-xs font-bold border transition-all flex items-center justify-center gap-1"
                            :class="newExpense.payer === 'Cherisa' ? 'bg-soft-brown text-white border-soft-brown' : 'bg-white text-gray-400 border-gray-200'"
                        >
                            <i class="ph-fill ph-user"></i> Cherisa 付款
                        </button>
                    </div>

                    <div class="grid grid-cols-12 gap-2 mb-2">
                        <!-- 項目輸入 (佔5格) -->
                        <input v-model="newExpense.item" class="col-span-5 bg-gray-50 rounded-lg px-3 py-2 text-sm outline-none focus:bg-white focus:ring-1 ring-soft-brown" placeholder="項目">
                        
                        <!-- 金額輸入 (佔4格) -->
                        <input v-model.number="newExpense.amount" type="number" class="col-span-4 bg-gray-50 rounded-lg px-3 py-2 text-sm outline-none focus:bg-white focus:ring-1 ring-soft-brown" placeholder="金額">

                        <!-- 幣別選擇 (佔3格) -->
                        <div class="col-span-3 flex bg-gray-100 rounded-lg p-1">
                            <button 
                                @click="newExpense.currency = 'KRW'" 
                                class="flex-1 text-xs font-bold rounded transition-all flex items-center justify-center" 
                                :class="newExpense.currency === 'KRW' ? 'bg-white shadow text-soft-brown' : 'text-gray-400'"
                            >₩</button>
                            <button 
                                @click="newExpense.currency = 'TWD'" 
                                class="flex-1 text-xs font-bold rounded transition-all flex items-center justify-center" 
                                :class="newExpense.currency === 'TWD' ? 'bg-white shadow text-soft-brown' : 'text-gray-400'"
                            >NT</button>
                        </div>
                    </div>
                    <button @click="addExpense" class="w-full bg-accent-beige text-soft-brown font-bold py-2 rounded-lg text-sm hover:bg-[#ebdcc0] transition-colors">
                        新增支出
                    </button>
                </div>

                <!-- 支出列表 -->
                <div class="space-y-3 pb-10">
                    <div v-for="(exp, index) in expenses" :key="index" class="flex justify-between items-center bg-white p-3 rounded-xl border border-gray-50 shadow-sm">
                        <div class="flex items-center gap-3">
                            <!-- 付款人頭像/標示 -->
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-white shrink-0"
                                 :class="exp.payer === 'Wawa' ? 'bg-indigo-300' : 'bg-rose-300'">
                                {{ exp.payer ? exp.payer[0] : '?' }}
                            </div>
                            <div>
                                <span class="text-gray-700 font-bold block">{{ exp.item }}</span>
                                <span class="text-[10px] text-gray-400 bg-gray-100 px-1.5 py-0.5 rounded">
                                    {{ exp.payer }} 付款
                                </span>
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <!-- 顯示幣別與金額 -->
                            <span class="font-bold text-soft-brown">
                                {{ exp.currency === 'TWD' ? 'NT$' : '₩' }} {{ exp.amount.toLocaleString() }}
                            </span>
                            <button @click="expenses.splice(index, 1)" class="text-gray-300 text-xs hover:text-red-400 p-1">
                                <i class="ph-fill ph-x-circle text-lg"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
        
        <!-- 行程編輯/新增 Modal -->
        <transition name="modal">
            <div v-if="showModal" class="fixed inset-0 z-50 flex items-center justify-center p-4">
                <div class="absolute inset-0 bg-black/40 backdrop-blur-sm" @click="closeModal"></div>
                <div class="bg-white rounded-3xl w-full max-w-sm p-6 relative z-10 shadow-2xl overflow-y-auto max-h-[90vh]">
                    <h3 class="text-xl font-bold text-soft-brown mb-4">{{ isEditing ? '編輯行程' : '新增行程' }}</h3>
                    
                    <div class="space-y-3">
                        <div>
                            <label class="text-xs font-bold text-gray-500 ml-1">標題</label>
                            <input v-model="editingEvent.title" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 outline-none focus:border-soft-brown" placeholder="要去哪裡？">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-xs font-bold text-gray-500 ml-1">時間</label>
                                <input v-model="editingEvent.time" type="time" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 outline-none focus:border-soft-brown">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 ml-1">地點 (Naver Map)</label>
                                <input v-model="editingEvent.location" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 outline-none focus:border-soft-brown" placeholder="搜尋關鍵字">
                            </div>
                        </div>

                        <!-- 圖片上傳區塊 (新增) -->
                        <div>
                            <label class="text-xs font-bold text-gray-500 ml-1">照片</label>
                            <div @click="triggerFileUpload" class="w-full h-32 bg-gray-50 border-2 border-dashed border-gray-200 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:bg-gray-100 overflow-hidden relative group">
                                <img v-if="editingEvent.image" :src="editingEvent.image" class="w-full h-full object-cover">
                                <div v-else class="text-center text-gray-400">
                                    <i class="ph-fill ph-camera text-2xl mb-1"></i>
                                    <span class="text-xs block">點擊上傳圖片</span>
                                </div>
                                <!-- 清除按鈕 -->
                                <button v-if="editingEvent.image" @click.stop="removeImage" class="absolute top-2 right-2 bg-black/50 text-white rounded-full p-1 hover:bg-black/70 z-10">
                                    <i class="ph-bold ph-x"></i>
                                </button>
                            </div>
                            <!-- 隱藏的 input -->
                            <input type="file" ref="fileInput" @change="handleFileChange" accept="image/*" class="hidden">
                        </div>

                        <!-- 新增：連結輸入欄位 -->
                        <div>
                            <label class="text-xs font-bold text-gray-500 ml-1">相關連結 (網頁/IG/App)</label>
                            <div class="relative">
                                <i class="ph-bold ph-link absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input v-model="editingEvent.link" class="w-full bg-gray-50 border border-gray-200 rounded-xl pl-9 pr-3 py-2 outline-none focus:border-soft-brown text-sm" placeholder="例如：IG貼文連結、部落格網址...">
                            </div>
                        </div>

                        <div>
                            <label class="text-xs font-bold text-gray-500 ml-1">描述/備註</label>
                            <textarea v-model="editingEvent.desc" rows="3" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-3 py-2 outline-none focus:border-soft-brown text-sm" placeholder="詳細內容..."></textarea>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-gray-500 ml-1">重點提示 (紅底)</label>
                            <input v-model="editingEvent.note" class="w-full bg-red-50 border border-red-100 rounded-xl px-3 py-2 outline-none focus:border-alert-red text-alert-red placeholder-red-300" placeholder="例如：需付訂金">
                        </div>
                    </div>

                    <div class="flex gap-3 mt-6">
                        <button v-if="isEditing" @click="deleteEvent" class="flex-1 py-3 rounded-xl border border-red-200 text-red-400 font-bold text-sm hover:bg-red-50">刪除</button>
                        <button @click="saveEvent" class="flex-[2] py-3 rounded-xl bg-soft-brown text-white font-bold text-sm shadow-lg shadow-soft-brown/30">儲存</button>
                    </div>
                    
                    <button @click="closeModal" class="absolute top-4 right-4 text-gray-300 hover:text-gray-500">
                        <i class="ph-bold ph-x text-xl"></i>
                    </button>
                </div>
            </div>
        </transition>

        <!-- Toast -->
        <div v-if="showToast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-full text-sm shadow-lg z-50 fade-in">
            已複製到剪貼簿！
        </div>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // ... existing data ...
                    currentTab: 'schedule',
                    currentDayIndex: 0, 
                    headerImage: './image.png', 
                    showToast: false,
                    showModal: false,
                    isEditing: false,
                    editingIndex: -1,
                    // 新增 link 欄位初始化
                    editingEvent: { title: '', time: '', location: '', desc: '', note: '', image: null, link: '' },
                    
                    tabs: [
                        { id: 'schedule', name: '行程', icon: 'ph-fill ph-calendar-check' },
                        { id: 'info', name: '資訊', icon: 'ph-fill ph-info' },
                        { id: 'shopping', name: '清單', icon: 'ph-fill ph-shopping-bag' },
                        { id: 'money', name: '花費', icon: 'ph-fill ph-coins' },
                    ],
                    
                    newItem: '',
                    currentShopper: 'Wawa',
                    shoppingList: [
                        { id: 1, text: 'Olive Young 面膜', done: false, owner: 'Wawa' },
                        { id: 2, text: 'Tamburins 護手霜', done: false, owner: 'Cherisa' },
                        { id: 3, text: 'Gentle Monster 墨鏡', done: false, owner: 'Wawa' },
                        { id: 4, text: 'Kakao Friends 公仔', done: false, owner: 'Cherisa' }
                    ],
                    
                    // Money 相關更新：加入 currency
                    newExpense: { item: '', amount: null, payer: 'Wawa', currency: 'KRW' }, 
                    expenses: [
                        { item: '旋律韓服訂金', amount: 40000, payer: 'Wawa', currency: 'KRW' }
                    ],
                    itinerary: [
                        {
                            date: '12/27 (六)',
                            weather: 'cloudy',
                            temp: '6° / -3°',
                            events: [
                                { time: '12:50', title: '抵達金浦機場', location: 'Gimpo International Airport' },
                                { time: '14:30', title: '民宿放行李', location: 'Wecostay Namsam', desc: '04554 중구 필동1가 43-1\nCheck-in: 16:00' },
                                { time: '17:00', title: '金豬食堂', location: 'Geumduit Sikdang', desc: '米其林推薦烤肉' },
                                { time: '19:00', title: '新羅免稅店', location: 'The Shilla Duty Free Seoul' },
                                { time: '21:00', title: '漢南洞 (時間允許)', location: 'Hannam-dong' }
                            ]
                        },
                        {
                            date: '12/28 (日)',
                            weather: 'sunny',
                            temp: '6° / -4°',
                            events: [
                                { time: '09:30', title: '旋律韓服', location: 'Melody Hanbok', desc: '套餐：情侶套餐 (35萬韓幣)\n包含：拍攝1hr、精修12張、髮妝造型\n攝影師：美樂蒂、阿君\n尾款：66萬韓幣 (建議付現)', note: '需支付尾款' },
                                { time: '13:00', title: '無垢屋吃飯', location: 'Mugunghwa', desc: '12:00 開放預約' },
                                { time: '17:30', title: 'Daybeau 明洞', location: 'Myeong-dong' },
                                { time: '21:00', title: '飯店炸雞', desc: '宵夜時間！' }
                            ]
                        },
                        {
                            date: '12/29 (一)',
                            weather: 'cloudy',
                            temp: '5° / -2°',
                            events: [
                                { title: '汝矣島現代百貨', location: 'The Hyundai Seoul', desc: '聖誕村拍照' },
                                { title: '新村 奶油燉排骨', location: 'Sinchon' },
                                { title: '弘大 逛街', location: 'Hongdae Shopping Street' }
                            ]
                        },
                        {
                            date: '12/30 (二)',
                            weather: 'sunny',
                            temp: '6° / -2°',
                            events: [
                                { time: '07:10', title: '明洞站集合', location: 'Myeong-dong Station', note: '前往芝山滑雪場' },
                                { time: '17:00', title: '回到明洞站' },
                                { time: '18:30', title: '一片里脊', desc: '已預約晚餐' },
                                { time: '20:00', title: '樂天超市', location: 'Lotte Mart Zettaplex Seoul Station' }
                            ]
                        },
                        {
                            date: '12/31 (三)',
                            weather: 'cloudy',
                            temp: '5° / -8°',
                            events: [
                                { title: '江南、狎鷗亭', location: 'Apgujeong Rodeo Street', desc: '逛街行程' },
                                { title: '星空圖書館', location: 'Starfield Library' },
                                { title: '蠶室樂天聖誕市集', location: 'Lotte World Tower', desc: '16:00前免費入場\n16:00後門票 5000\n快速通關 10000', note: '降雪秀: 13/15/17:30/19/20:30' },
                                { time: '23:59', title: '樂天世界塔跨年煙火', location: 'Lotte World Tower' }
                            ]
                        },
                        {
                            date: '01/01 (四)',
                            weather: 'sunny',
                            temp: '-1° / -8°',
                            events: [
                                { title: '聖水洞', location: 'Seongsu-dong', desc: '咖啡廳與逛街' }
                            ]
                        },
                        {
                            date: '01/02 (五)',
                            weather: 'sunny',
                            temp: '-1° / -8°',
                            events: [
                                { title: '前往金浦機場', location: 'Gimpo International Airport' },
                                { time: '13:50', title: '飛機起飛 BR155' },
                                { time: '15:35', title: '抵達松山機場' }
                            ]
                        }
                    ],
                    weatherTypes: ['sunny', 'cloudy', 'rain', 'snow']
                }
            },
            computed: {
                // Money 相關計算 (雙幣別獨立)
                totalKRW() {
                    return this.expenses
                        .filter(e => e.currency === 'KRW')
                        .reduce((sum, item) => sum + item.amount, 0);
                },
                totalTWD() {
                    return this.expenses
                        .filter(e => e.currency === 'TWD')
                        .reduce((sum, item) => sum + item.amount, 0);
                },
                // Wawa 代墊
                wawaPaidKRW() {
                    return this.expenses
                        .filter(e => e.payer === 'Wawa' && e.currency === 'KRW')
                        .reduce((sum, item) => sum + item.amount, 0);
                },
                wawaPaidTWD() {
                    return this.expenses
                        .filter(e => e.payer === 'Wawa' && e.currency === 'TWD')
                        .reduce((sum, item) => sum + item.amount, 0);
                },
                // Cherisa 代墊
                cherisaPaidKRW() {
                    return this.expenses
                        .filter(e => e.payer === 'Cherisa' && e.currency === 'KRW')
                        .reduce((sum, item) => sum + item.amount, 0);
                },
                cherisaPaidTWD() {
                    return this.expenses
                        .filter(e => e.payer === 'Cherisa' && e.currency === 'TWD')
                        .reduce((sum, item) => sum + item.amount, 0);
                },
                // 分帳建議文字
                settlementKRWText() {
                    const diff = this.wawaPaidKRW - this.cherisaPaidKRW;
                    const halfDiff = Math.abs(diff) / 2;
                    if (Math.round(halfDiff) === 0) return null;
                    
                    return diff > 0 
                        ? `Cherisa 給 Wawa ₩ ${Math.round(halfDiff).toLocaleString()}`
                        : `Wawa 給 Cherisa ₩ ${Math.round(halfDiff).toLocaleString()}`;
                },
                settlementTWDText() {
                    const diff = this.wawaPaidTWD - this.cherisaPaidTWD;
                    const halfDiff = Math.abs(diff) / 2;
                    if (Math.round(halfDiff) === 0) return null;

                    return diff > 0 
                        ? `Cherisa 給 Wawa NT$ ${Math.round(halfDiff).toLocaleString()}`
                        : `Wawa 給 Cherisa NT$ ${Math.round(halfDiff).toLocaleString()}`;
                },
                
                currentDayData() {
                    return this.itinerary[this.currentDayIndex];
                },
                filteredShoppingList() {
                    return this.shoppingList.filter(item => item.owner === this.currentShopper);
                }
            },
            methods: {
                // ... existing methods ...
                addExpense() {
                    if (this.newExpense.item && this.newExpense.amount) {
                        // 確保預設值
                        if (!this.newExpense.payer) this.newExpense.payer = 'Wawa';
                        if (!this.newExpense.currency) this.newExpense.currency = 'KRW';
                        
                        this.expenses.push({ ...this.newExpense });
                        
                        // 重置輸入，但保留 payer 和 currency 方便連續輸入
                        const currentPayer = this.newExpense.payer;
                        const currentCurrency = this.newExpense.currency;
                        this.newExpense = { item: '', amount: null, payer: currentPayer, currency: currentCurrency };
                    }
                },
                handleImageError(e) {
                    e.target.src = 'https://images.unsplash.com/photo-1538485399081-7191377e8241?q=80&w=1920&auto=format&fit=crop';
                },
                
                getNaverLink(query) {
                    return `https://map.naver.com/v5/search/${encodeURIComponent(query)}`;
                },
                copyText(text) {
                    navigator.clipboard.writeText(text).then(() => {
                        this.showToast = true;
                        setTimeout(() => this.showToast = false, 2000);
                    });
                },
                // 修改：新增項目時自動帶入 currentShopper
                addItem() {
                    if (this.newItem.trim()) {
                        this.shoppingList.push({ 
                            id: Date.now(),
                            text: this.newItem, 
                            done: false,
                            owner: this.currentShopper
                        });
                        this.newItem = '';
                    }
                },
                // 修改：刪除邏輯改為 ID 比對 (因為現在列表是過濾過的，index 會不準)
                deleteItem(itemToDelete) {
                    this.shoppingList = this.shoppingList.filter(item => item.id !== itemToDelete.id);
                },
                // 天氣相關
                getWeatherIcon(type) {
                    const icons = {
                        'sunny': 'ph-fill ph-sun text-amber-400',
                        'cloudy': 'ph-fill ph-cloud text-gray-400',
                        'rain': 'ph-fill ph-cloud-rain text-blue-400',
                        'snow': 'ph-fill ph-snowflake text-sky-300'
                    };
                    return icons[type] || icons['sunny'];
                },
                getWeatherName(type) {
                    const names = { 'sunny': '晴天', 'cloudy': '多雲', 'rain': '下雨', 'snow': '下雪' };
                    return names[type];
                },
                cycleWeather(dayIndex) {
                    const current = this.itinerary[dayIndex].weather;
                    const idx = this.weatherTypes.indexOf(current);
                    const nextIdx = (idx + 1) % this.weatherTypes.length;
                    this.itinerary[dayIndex].weather = this.weatherTypes[nextIdx];
                },
                // 圖片上傳處理
                triggerFileUpload() {
                    this.$refs.fileInput.click();
                },
                handleFileChange(event) {
                    const file = event.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.editingEvent.image = e.target.result;
                        };
                        reader.readAsDataURL(file);
                    }
                },
                removeImage() {
                    this.editingEvent.image = null;
                    // 清空 input 讓同檔名可再次選取
                    if (this.$refs.fileInput) {
                        this.$refs.fileInput.value = '';
                    }
                },
                // 行程 CRUD Modal
                openAddModal() {
                    this.isEditing = false;
                    // 初始化包含 link
                    this.editingEvent = { title: '', time: '', location: '', desc: '', note: '', image: null, link: '' };
                    this.showModal = true;
                },
                openEditModal(eventIndex) {
                    this.isEditing = true;
                    this.editingIndex = eventIndex;
                    // 深拷貝以避免直接修改影響顯示，直到按下儲存
                    this.editingEvent = JSON.parse(JSON.stringify(this.currentDayData.events[eventIndex]));
                    // 確保有 image 與 link 欄位 (避免舊資料沒有)
                    if (!this.editingEvent.image) this.editingEvent.image = null;
                    if (!this.editingEvent.link) this.editingEvent.link = '';
                    
                    this.showModal = true;
                },
                closeModal() {
                    this.showModal = false;
                    this.editingIndex = -1;
                },
                saveEvent() {
                    if (!this.editingEvent.title) return; // 簡單防呆

                    if (this.isEditing) {
                        this.itinerary[this.currentDayIndex].events[this.editingIndex] = { ...this.editingEvent };
                    } else {
                        // 新增行程時，簡單的排序邏輯 (有時間的排前面)
                        this.itinerary[this.currentDayIndex].events.push({ ...this.editingEvent });
                        this.itinerary[this.currentDayIndex].events.sort((a, b) => (a.time || '23:59').localeCompare(b.time || '23:59'));
                    }
                    this.closeModal();
                },
                deleteEvent() {
                    if (confirm('確定要刪除這個行程嗎？')) {
                        this.itinerary[this.currentDayIndex].events.splice(this.editingIndex, 1);
                        this.closeModal();
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>




